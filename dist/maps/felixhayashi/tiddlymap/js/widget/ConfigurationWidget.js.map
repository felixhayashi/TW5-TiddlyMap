{"version":3,"sources":["felixhayashi/tiddlymap/js/widget/ConfigurationWidget.js"],"names":["MapConfigWidget","parseTreeNode","options","Widget","call","initialise","computeAttributes","prototype","Object","create","render","parent","nextSibling","parentDomNode","domNode","document","createElement","$tw","utils","addClass","insertBefore","network","destroy","networkContainer","appendChild","refreshTrigger","getAttribute","pipeTRef","getVariable","inheritedFields","parseStringArray","extensionTField","mode","i","length","fieldName","style","parseFieldData","edges","nodes","inherited","merge","extension","isSaveOnlyChanges","isTrue","changes","data","extend","configure","enabled","showButton","filter","getOptionFilter","vis","Network","on","handleConfigChange","bind","height","getBoundingClientRect","reset","handleResetEvent","addEventListener","$tm","registry","push","enhanceConfigurator","ev","change","detail","trigger","path","flatChanges","flatten","flatChange","confPath","keys","isReset","undefined","unflatten","writeFieldData","config","sys","jsonIndentation","cls","div","getElementsByClassName","window","setTimeout","refresh","elements","children","list","classList","contains","conf","VisConfElement","level","setActive","el","pos","getByCls","labelEl","labelText","innerText","textContent","label","match","parseInt","className","prev","isEnable","button","innerHTML","self","currentTarget","dispatchEvent","CustomEvent","bubbles","cancelable","whitelist","borderWidth","borderWidthSelected","color","background","border","font","size","icon","labelHighlightBold","shadow","shape","shapeProperties","borderDashes","arrows","dashes","selfReferenceSize","smooth","width","interaction","hideEdgesOnDrag","hideNodesOnDrag","tooltipDelay","layout","hierarchical","manipulation","initiallyActive","physics","forceAtlas2Based","gravitationalConstant","springLength","springConstant","damping","centralGravity","option","concat","wlObj","l","isZombieWidget","body","destruct","changedTiddlers","refreshSelf","setNull","obj","p","exports"],"mappings":";;8QAAA;AACA;;;;;;;;;;AAUA;;;;AACA;;;;AACA;;;;AAEA;;;;;;;;;;;;;;;AAeA,SAASA,eAAT,CAAyBC,aAAzB,EAAwCC,OAAxC,EAAiD;;AAE/C;AACAC,iBAAOC,IAAP,CAAY,IAAZ;;AAEA;AACA,OAAKC,UAAL,CAAgBJ,aAAhB,EAA+BC,OAA/B;;AAEA;AACA,OAAKI,iBAAL;AAED;;AAED;AACAN,gBAAgBO,SAAhB,GAA4BC,OAAOC,MAAP,CAAcN,eAAOI,SAArB,CAA5B;AACA;;AAEA;;;;;AAKAP,gBAAgBO,SAAhB,CAA0BG,MAA1B,GAAmC,UAASC,MAAT,EAAiBC,WAAjB,EAA8B;;AAE/D;AACA,OAAKC,aAAL,GAAqBF,MAArB;;AAEA,MAAI,CAAC,KAAKG,OAAV,EAAmB;AACjB,SAAKA,OAAL,GAAe,KAAKC,QAAL,CAAcC,aAAd,CAA4B,KAA5B,CAAf;AACAC,QAAIC,KAAJ,CAAUC,QAAV,CAAmB,KAAKL,OAAxB,EAAiC,oBAAjC;AACAH,WAAOS,YAAP,CAAoB,KAAKN,OAAzB,EAAkCF,WAAlC;AACD;;AAED,MAAI,KAAKS,OAAT,EAAkB;;AAEhB;AACA,SAAKA,OAAL,CAAaC,OAAb;AAED;;AAED;AACA,OAAKC,gBAAL,GAAwBR,SAASC,aAAT,CAAuB,KAAvB,CAAxB;AACA,OAAKF,OAAL,CAAaU,WAAb,CAAyB,KAAKD,gBAA9B;;AAEA;AACA,OAAKE,cAAL,GAAsB,KAAKC,YAAL,CAAkB,iBAAlB,CAAtB;AACA,OAAKC,QAAL,GAAgB,KAAKC,WAAL,CAAiB,gBAAjB,CAAhB;AACA,OAAKC,eAAL,GAAuBZ,IAAIC,KAAJ,CAAUY,gBAAV,CAA2B,KAAKJ,YAAL,CAAkB,WAAlB,CAA3B,CAAvB;AACA,OAAKK,eAAL,GAAuB,KAAKL,YAAL,CAAkB,WAAlB,CAAvB;AACA,OAAKM,IAAL,GAAY,KAAKN,YAAL,CAAkB,MAAlB,CAAZ;;AAEA;AACA,OAAK,IAAIO,IAAI,CAAb,EAAgBA,IAAI,KAAKJ,eAAL,CAAqBK,MAAzC,EAAiDD,GAAjD,EAAsD;AACpD,QAAIE,YAAY,KAAKN,eAAL,CAAqBI,CAArB,CAAhB;AACA,QAAIG,QAAQlB,gBAAMmB,cAAN,CAAqB,KAAKV,QAA1B,EAAoCQ,SAApC,EAA+C,EAA/C,CAAZ;;AAEA;AACA;AACA;AACA,QAAI,KAAKH,IAAL,KAAc,mBAAlB,EAAuC;AACrC,UAAI,CAACI,MAAME,KAAX,EAAkB;AAAEF,gBAAQ,EAAEE,OAAOF,KAAT,EAAR;AAA2B;AAChD,KAFD,MAEO,IAAI,KAAKJ,IAAL,KAAc,mBAAlB,EAAuC;AAC5C,UAAI,CAACI,MAAMG,KAAX,EAAkB;AAAEH,gBAAQ,EAAEG,OAAOH,KAAT,EAAR;AAA2B;AAChD;;AAED,SAAKI,SAAL,GAAiBtB,gBAAMuB,KAAN,CAAY,KAAKD,SAAjB,EAA4BJ,KAA5B,CAAjB;AAED;;AAED;AACA;AACA;AACA,OAAKM,SAAL,GAAiBxB,gBAAMmB,cAAN,CAAqB,KAAKV,QAA1B,EAAoC,KAAKI,eAAzC,EAA0D,EAA1D,CAAjB;AACA;AACA,MAAI,KAAKC,IAAL,KAAc,mBAAlB,EAAuC;AACrC,QAAI,CAAC,KAAKU,SAAL,CAAeJ,KAApB,EAA2B;AACzB,WAAKI,SAAL,GAAiB,EAAEJ,OAAO,KAAKI,SAAd,EAAjB;AACD;AACF,GAJD,MAIO,IAAI,KAAKV,IAAL,KAAc,mBAAlB,EAAuC;AAC5C,QAAI,CAAC,KAAKU,SAAL,CAAeH,KAApB,EAA2B;AACzB,WAAKG,SAAL,GAAiB,EAAEH,OAAO,KAAKG,SAAd,EAAjB;AACD;AACF;;AAED;AACA,MAAIC,oBAAoBzB,gBAAM0B,MAAN,CAAa,KAAKlB,YAAL,CAAkB,mBAAlB,CAAb,CAAxB;AACA,OAAKmB,OAAL,GAAgBF,oBAAoB,EAApB,GAAyB,KAAKD,SAA9C;;AAEA,MAAII,OAAO,EAAEP,OAAO,EAAT,EAAaD,OAAO,EAApB,EAAX;AACA,MAAIpC,UAAUgB,gBAAMuB,KAAN,CAAY,EAAZ,EAAgB,KAAKD,SAArB,EAAgC,KAAKE,SAArC,CAAd;AACAzB,MAAIC,KAAJ,CAAU6B,MAAV,CAAiB7C,OAAjB,EAA0B;AACxB8C,eAAW;AACTC,eAAS,IADA;AAETC,kBAAY,KAFH;AAGTC,cAAQ,KAAKC,eAAL,CAAqB,KAAKpB,IAA1B;AAHC;AADa,GAA1B;;AAQA,OAAKX,OAAL,GAAe,IAAIgC,cAAIC,OAAR,CAAgB,KAAK/B,gBAArB,EAAuCuB,IAAvC,EAA6C5C,OAA7C,CAAf;AACA,OAAKmB,OAAL,CAAakC,EAAb,CAAgB,cAAhB,EAAgC,KAAKC,kBAAL,CAAwBC,IAAxB,CAA6B,IAA7B,CAAhC;;AAEA;AACA;AACA;AACA;AACA,MAAIC,SAAS,KAAK7C,aAAL,CAAmB8C,qBAAnB,GAA2CD,MAAxD;AACA,OAAK7C,aAAL,CAAmBuB,KAAnB,CAAyB,QAAzB,IAAqCsB,SAAS,IAA9C;;AAEA,MAAIE,QAAQ,KAAKC,gBAAL,CAAsBJ,IAAtB,CAA2B,IAA3B,CAAZ;AACA,OAAKlC,gBAAL,CAAsBuC,gBAAtB,CAAuC,OAAvC,EAAgDF,KAAhD,EAAuD,KAAvD;;AAEA;AACAG,MAAIC,QAAJ,CAAaC,IAAb,CAAkB,IAAlB;;AAGA,OAAKC,mBAAL;AAED,CA/FD;;AAiGA;;;AAGAlE,gBAAgBO,SAAhB,CAA0BsD,gBAA1B,GAA6C,UAASM,EAAT,EAAa;AACxD,MAAIC,SAAS,EAAb;AACAA,SAAOD,GAAGE,MAAH,CAAUC,OAAV,CAAkBC,IAAzB,IAAiC,IAAjC;AACA,OAAKf,kBAAL,CAAwBY,MAAxB;AACD,CAJD;;AAMA;;;AAGApE,gBAAgBO,SAAhB,CAA0BiD,kBAA1B,GAA+C,UAASY,MAAT,EAAiB;;AAE9D,MAAII,cAActD,gBAAMuD,OAAN,CAAc,KAAK5B,OAAnB,CAAlB;AACA,MAAI6B,aAAaxD,gBAAMuD,OAAN,CAAcL,MAAd,CAAjB;AACA,MAAIO,WAAWnE,OAAOoE,IAAP,CAAY1D,gBAAMuD,OAAN,CAAcL,MAAd,CAAZ,EAAmC,CAAnC,CAAf;AACA,MAAIS,UAAWH,WAAWC,QAAX,MAAyB,IAAxC;;AAEA,MAAIE,OAAJ,EAAa;AAAE;;AAEbL,gBAAYG,QAAZ,IAAwBG,SAAxB;AACA,SAAKjC,OAAL,GAAe3B,gBAAM6D,SAAN,CAAgBP,WAAhB,CAAf;AAED,GALD,MAKO;;AAEL,SAAK3B,OAAL,GAAe3B,gBAAMuB,KAAN,CAAY,KAAKI,OAAjB,EAA0BuB,MAA1B,CAAf;AACD;;AAED;AACA,MAAIlE,UAAUgB,gBAAMuB,KAAN,CAAY,EAAZ,EAAgB,KAAKI,OAArB,CAAd;AACA,MAAI,KAAKb,IAAL,KAAc,mBAAlB,EAAuC;AAAE9B,cAAUA,QAAQ,OAAR,CAAV;AAA6B;AACtE,MAAI,KAAK8B,IAAL,KAAc,mBAAlB,EAAuC;AAAE9B,cAAUA,QAAQ,OAAR,CAAV;AAA6B;;AAEtE;AACAgB,kBAAM8D,cAAN,CAAqB,KAAKrD,QAA1B,EAAoC,KAAKI,eAAzC,EAA0D7B,OAA1D,EAAmE6D,IAAIkB,MAAJ,CAAWC,GAAX,CAAeC,eAAlF;;AAEA;AACA,MAAIC,MAAM,2BAAV;AACA,MAAIC,MAAM,KAAK9D,gBAAL,CAAsB+D,sBAAtB,CAA6CF,GAA7C,EAAkD,CAAlD,CAAV;AACAC,MAAIjD,KAAJ,CAAUsB,MAAV,GAAmB2B,IAAI1B,qBAAJ,GAA4BD,MAA5B,GAAqC,IAAxD;;AAEA,MAAImB,OAAJ,EAAa;;AAEX;AACA;AACAU,WAAOC,UAAP,CAAkB,KAAKC,OAAL,CAAahC,IAAb,CAAkB,IAAlB,CAAlB,EAA2C,CAA3C;AAED,GAND,MAMO;;AAEL;AACA8B,WAAOC,UAAP,CAAkB,KAAKtB,mBAAL,CAAyBT,IAAzB,CAA8B,IAA9B,CAAlB,EAAuD,EAAvD;AAED;AAEF,CA3CD;;AA6CA;;;AAGAzD,gBAAgBO,SAAhB,CAA0B2D,mBAA1B,GAAgD,YAAW;;AAEzD,MAAIkB,MAAM,2BAAV;AACA,MAAIM,WAAW,KAAKnE,gBAAL,CACK+D,sBADL,CAC4BF,GAD5B,EACiC,CADjC,EACoCO,QADnD;AAEA,MAAIC,OAAO,EAAX;AACA,MAAI/C,UAAU3B,gBAAMuD,OAAN,CAAc,KAAK5B,OAAnB,CAAd;AACA,OAAK,IAAIZ,IAAI,CAAb,EAAgBA,IAAIyD,SAASxD,MAA7B,EAAqCD,GAArC,EAA0C;AACxC,QAAI,CAACyD,SAASzD,CAAT,EAAY4D,SAAZ,CAAsBC,QAAtB,CAA+B,iBAA/B,CAAL,EAAwD;;AAExD,QAAIC,OAAO,IAAIC,cAAJ,CAAmBN,SAASzD,CAAT,CAAnB,EAAgC2D,IAAhC,EAAsC3D,CAAtC,CAAX;AACA2D,SAAK3B,IAAL,CAAU8B,IAAV;;AAEA,QAAIA,KAAKE,KAAL,KAAe,CAAnB,EAAsB;;AAEtBF,SAAKG,SAAL,CAAe,CAAC,CAACrD,QAAQkD,KAAKxB,IAAb,CAAjB;AAED;AACF,CAlBD;;AAoBA;;;;;;;AAOA,SAASyB,cAAT,CAAwBG,EAAxB,EAA4BP,IAA5B,EAAkCQ,GAAlC,EAAuC;;AAErC,MAAIC,WAAW,wBAAf;;AAEA,OAAKF,EAAL,GAAUA,EAAV;AACA,OAAKG,OAAL,GAAeH,GAAGE,QAAH,EAAa,kBAAb,EAAiC,CAAjC,KACGF,GAAGE,QAAH,EAAa,mBAAb,EAAkC,CAAlC,CADH,IAEGF,EAFlB;AAGA,MAAII,YAAa,KAAKD,OAAL,CAAaE,SAAb,IAA0B,KAAKF,OAAL,CAAaG,WAAxD;AACA,OAAKC,KAAL,GAAaH,aAAaA,UAAUI,KAAV,CAAgB,gBAAhB,EAAkC,CAAlC,CAA1B;AACA,OAAKV,KAAL,GAAaW,SAAST,GAAGU,SAAH,CAAaF,KAAb,CAAmB,qBAAnB,EAA0C,CAA1C,CAAT,KAA0D,CAAvE;;AAEA,OAAKpC,IAAL,GAAY,KAAKmC,KAAjB;;AAEA,MAAI,KAAKT,KAAL,GAAa,CAAjB,EAAoB;AAClB,SAAK,IAAIhE,IAAImE,GAAb,EAAkBnE,GAAlB,GAAwB;AACtB,UAAI6E,OAAOlB,KAAK3D,CAAL,CAAX;AACA,UAAI6E,KAAKb,KAAL,GAAa,KAAKA,KAAtB,EAA6B;AAC3B,aAAK1B,IAAL,GAAYuC,KAAKvC,IAAL,GAAY,GAAZ,GAAkB,KAAKA,IAAnC;AACA;AACD;AACF;AACF;AACF;;AAEDyB,eAAezF,SAAf,CAAyB2F,SAAzB,GAAqC,UAASa,QAAT,EAAmB;;AAEtD,MAAI,CAACA,QAAL,EAAe;;AAEf;AACA;AACA,MAAI3B,MAAM,2BAA2B2B,WAAW,QAAX,GAAsB,UAAjD,CAAV;AACA9F,MAAIC,KAAJ,CAAUC,QAAV,CAAmB,KAAKgF,EAAxB,EAA4Bf,GAA5B;;AAEA,MAAI2B,QAAJ,EAAc;;AAEZ,QAAIC,SAASjG,SAASC,aAAT,CAAuB,QAAvB,CAAb;AACAgG,WAAOC,SAAP,GAAmB,OAAnB;AACAD,WAAOH,SAAP,GAAmB,wBAAnB;;AAEA,QAAIK,OAAO,IAAX;;AAEAF,WAAOlD,gBAAP,CAAwB,OAAxB,EAAiC,UAASK,EAAT,EAAa;AAC5CA,SAAGgD,aAAH,CAAiBC,aAAjB,CAA+B,IAAIC,WAAJ,CAAgB,OAAhB,EAAyB;AACtDhD,gBAAQ,EAAEC,SAAS4C,IAAX,EAD8C;AAEtDI,iBAAS,IAF6C;AAGtDC,oBAAY;AAH0C,OAAzB,CAA/B;AAKD,KAND,EAMG,KANH;;AAQA,SAAKpB,EAAL,CAAQ3E,WAAR,CAAoBwF,MAApB;AACD;AAEF,CA5BD;;AA8BA;;;;AAIAhH,gBAAgBO,SAAhB,CAA0B6C,eAA1B,GAA4C,UAASpB,IAAT,EAAe;;AAEzD,MAAIwF,YAAY;AACdjF,WAAO;AACLkF,mBAAa,IADR;AAELC,2BAAqB,IAFhB;AAGLC,aAAO;AACLC,oBAAY,IADP;AAELC,gBAAQ;AAFH,OAHF;AAOLC,YAAM;AACJH,eAAO,IADH;AAEJI,cAAM;AAFF,OAPD;AAWLC,YAAM,IAXD;AAYLC,0BAAoB,KAZf;AAaLC,cAAQ,IAbH;AAcLC,aAAO,IAdF;AAeLC,uBAAiB;AACfC,sBAAc;;AADC,OAfZ;AAmBLN,YAAM;AAnBD,KADO;AAsBdzF,WAAO;AACLgG,cAAQ,IADH;AAELX,aAAO,IAFF;AAGLY,cAAQ,IAHH;AAILT,YAAM,IAJD;AAKLG,0BAAoB,KALf;AAML/F,cAAQ,IANH;AAOLsG,yBAAmB,KAPd;AAQLN,cAAQ,IARH;AASLO,cAAQ,IATH;AAULC,aAAO;AAVF,KAtBO;AAkCdC,iBAAa;AACXC,uBAAiB,IADN;AAEXC,uBAAiB,IAFN;AAGXC,oBAAc;AAHH,KAlCC;AAuCdC,YAAQ;AACNC,oBAAc;AADR,KAvCM;AA0CdC,kBAAc;AACZC,uBAAiB;AADL,KA1CA;AA6CdC,aAAS;AACPC,wBAAkB;AAChBC,+BAAuB,IADP;AAEhBC,sBAAc,IAFE;AAGhBC,wBAAgB,IAHA;AAIhBC,iBAAS,IAJO;AAKhBC,wBAAgB;AALA;AADX;AA7CK,GAAhB;;AAwDA,MAAIzH,SAAS,mBAAb,EAAkC;AAChCwF,gBAAY,EAAElF,OAAOkF,UAAUlF,KAAnB,EAAZ;AACD,GAFD,MAEO,IAAIN,SAAS,mBAAb,EAAkC;AACvCwF,gBAAY,EAAEjF,OAAOiF,UAAUjF,KAAnB,EAAZ;AACD,GAFM,MAEA;AACLiF,cAAUlF,KAAV,CAAgBgG,MAAhB,GAAyB,KAAzB;AACD;;AAED,SAAO,UAASoB,MAAT,EAAiBnF,IAAjB,EAAuB;;AAE5B;AACAA,WAAOA,KAAKoF,MAAL,CAAY,CAAED,MAAF,CAAZ,CAAP;;AAEA,QAAIE,QAAQpC,SAAZ;AACA,SAAK,IAAIvF,IAAI,CAAR,EAAW4H,IAAItF,KAAKrC,MAAzB,EAAiCD,IAAI4H,CAArC,EAAwC5H,GAAxC,EAA6C;AAC3C,UAAI2H,MAAMrF,KAAKtC,CAAL,CAAN,MAAmB,IAAvB,EAA6B;AAC3B,eAAO,IAAP;AACD,OAFD,MAEO,IAAI2H,MAAMrF,KAAKtC,CAAL,CAAN,KAAkB,IAAtB,EAA4B;AACjC,eAAO,KAAP;AACD,OAL0C,CAKzC;AACF2H,cAAQA,MAAMrF,KAAKtC,CAAL,CAAN,CAAR;AACD;;AAED,WAAO,KAAP;AAED,GAjBD;AAmBD,CArFD;;AAuFA;;;;;;;AAOAjC,gBAAgBO,SAAhB,CAA0BuJ,cAA1B,GAA2C,YAAW;;AAEpD,SAAO,CAAC/I,SAASgJ,IAAT,CAAcjE,QAAd,CAAuB,KAAKjF,aAA5B,CAAR;AAED,CAJD;;AAMA;;;;;AAKAb,gBAAgBO,SAAhB,CAA0ByJ,QAA1B,GAAqC,YAAW;;AAE9C,MAAI,KAAK3I,OAAT,EAAkB;AAChB,SAAKA,OAAL,CAAaC,OAAb;AACD;AAEF,CAND;;AAQA;;;;;;AAMAtB,gBAAgBO,SAAhB,CAA0BkF,OAA1B,GAAoC,UAASwE,eAAT,EAA0B;;AAE5D,MAAI,KAAKH,cAAL,MAAyB,CAAC,KAAKzI,OAAnC,EAA4C;;AAE5C,MAAI,CAAC4I,eAAD,IAAoBA,gBAAgB,KAAKxI,cAArB,CAAxB,EAA8D;AAC5D,SAAKyI,WAAL;AACA,WAAO,IAAP;AACD;AAEF,CATD;;AAWAlK,gBAAgBO,SAAhB,CAA0B4J,OAA1B,GAAoC,UAASC,GAAT,EAAc;;AAEhD,OAAK,IAAIC,CAAT,IAAcD,GAAd,EAAmB;;AAEjB,QAAI,QAAOA,IAAIC,CAAJ,CAAP,KAAiB,QAArB,EAA+B;;AAE7B,WAAKF,OAAL,CAAaC,IAAIC,CAAJ,CAAb;AACD,KAHD,MAGO;;AAELD,UAAIC,CAAJ,IAASvF,SAAT;AACD;AACF;AAEF,CAbD;;AAgBA;;AAEAwF,QAAQ,aAAR,IAAyBtK,eAAzB","file":"../../../../../felixhayashi/tiddlymap/js/widget/ConfigurationWidget.js","sourcesContent":["// @preserve\n/*\\\n\ntitle: $:/plugins/felixhayashi/tiddlymap/js/widget/MapConfigWidget\ntype: application/javascript\nmodule-type: widget\n\n@preserve\n\n\\*/\n\nimport utils from '$:/plugins/felixhayashi/tiddlymap/js/utils';\nimport vis from '$:/plugins/felixhayashi/vis/vis.js';\nimport { widget as Widget } from '$:/core/modules/widgets/widget.js';\n\n/**\n * Wrapper for the Visjs configurator.\n *\n * ```\n * <$tmap-config\n *     inherited=\"FIELDNAME FIELDNAME …\"\n *     extension=\"FIELDNAME\"\n *     changes=\"FIELDNAME\" (default: same field as extension)\n *     override=\"true|false\" (default: false)\n *     mode=\"manage-*\"\n *     refresh-trigger=\"tRef\" />\n * ```\n *\n * @constructor\n */\nfunction MapConfigWidget(parseTreeNode, options) {\n\n  // call the parent constructor\n  Widget.call(this);\n\n  // call initialise on prototype\n  this.initialise(parseTreeNode, options);\n\n  // make the html attributes available to this widget\n  this.computeAttributes();\n\n}\n\n// !! EXTENSION !!\nMapConfigWidget.prototype = Object.create(Widget.prototype);\n// !! EXTENSION !!\n\n/**\n * Method to render this widget into the DOM.\n *\n * @override\n */\nMapConfigWidget.prototype.render = function(parent, nextSibling) {\n\n  // remember our place in the dom\n  this.parentDomNode = parent;\n\n  if (!this.domNode) {\n    this.domNode = this.document.createElement('div');\n    $tw.utils.addClass(this.domNode, 'tmap-config-widget');\n    parent.insertBefore(this.domNode, nextSibling);\n  }\n\n  if (this.network) {\n\n    // destroy any previous instance\n    this.network.destroy();\n\n  }\n\n  // create container for vis configurator; destroyed when vis is destroyed\n  this.networkContainer = document.createElement('div');\n  this.domNode.appendChild(this.networkContainer);\n\n  // get environment\n  this.refreshTrigger = this.getAttribute('refresh-trigger');\n  this.pipeTRef = this.getVariable('currentTiddler');\n  this.inheritedFields = $tw.utils.parseStringArray(this.getAttribute('inherited'));\n  this.extensionTField = this.getAttribute('extension');\n  this.mode = this.getAttribute('mode');\n\n  // load inherited options\n  for (var i = 0; i < this.inheritedFields.length; i++) {\n    var fieldName = this.inheritedFields[i];\n    var style = utils.parseFieldData(this.pipeTRef, fieldName, {});\n\n    // maybe the inherited options also come without a top level property\n    // so we do the same here to…\n    // TODO looks clumsy; do it in a more generic way…\n    if (this.mode === 'manage-edge-types') {\n      if (!style.edges) { style = { edges: style }; }\n    } else if (this.mode === 'manage-node-types') {\n      if (!style.nodes) { style = { nodes: style }; }\n    }\n\n    this.inherited = utils.merge(this.inherited, style);\n\n  }\n\n  // load extension to the inherited options; since we store vis config\n  // for nodes and edges without the top level property, we may need to\n  // append it again, if not done so already.\n  this.extension = utils.parseFieldData(this.pipeTRef, this.extensionTField, {});\n  // TODO looks clumsy; do it in a more generic way…\n  if (this.mode === 'manage-edge-types') {\n    if (!this.extension.edges) {\n      this.extension = { edges: this.extension };\n    }\n  } else if (this.mode === 'manage-node-types') {\n    if (!this.extension.nodes) {\n      this.extension = { nodes: this.extension };\n    }\n  }\n\n  // we record all changes in a separate variable\n  var isSaveOnlyChanges = utils.isTrue(this.getAttribute('save-only-changes'));\n  this.changes = (isSaveOnlyChanges ? {} : this.extension);\n\n  var data = { nodes: [], edges: [] };\n  var options = utils.merge({}, this.inherited, this.extension);\n  $tw.utils.extend(options, {\n    configure: {\n      enabled: true,\n      showButton: false,\n      filter: this.getOptionFilter(this.mode)\n    }\n  });\n\n  this.network = new vis.Network(this.networkContainer, data, options);\n  this.network.on('configChange', this.handleConfigChange.bind(this));\n\n  // giving the parent a css height will prevent it from jumping\n  // back when the network is destroyed and the network\n  // container is removed.\n  // fixes https://github.com/almende/vis/issues/1568\n  var height = this.parentDomNode.getBoundingClientRect().height;\n  this.parentDomNode.style['height'] = height + 'px';\n\n  var reset = this.handleResetEvent.bind(this);\n  this.networkContainer.addEventListener('reset', reset, false);\n\n  // register this graph at the caretaker's graph registry\n  $tm.registry.push(this);\n\n\n  this.enhanceConfigurator();\n\n};\n\n/**\n * I only receive the option that has actually changed\n */\nMapConfigWidget.prototype.handleResetEvent = function(ev) {\n  var change = {};\n  change[ev.detail.trigger.path] = null;\n  this.handleConfigChange(change);\n};\n\n/**\n * I only receive the option that has actually changed\n */\nMapConfigWidget.prototype.handleConfigChange = function(change) {\n\n  var flatChanges = utils.flatten(this.changes);\n  var flatChange = utils.flatten(change);\n  var confPath = Object.keys(utils.flatten(change))[0];\n  var isReset = (flatChange[confPath] === null);\n\n  if (isReset) { // we interpret this as delete\n\n    flatChanges[confPath] = undefined;\n    this.changes = utils.unflatten(flatChanges);\n\n  } else {\n\n    this.changes = utils.merge(this.changes, change);\n  }\n\n  // when storing edge- or node-styles we strip the root property\n  var options = utils.merge({}, this.changes);\n  if (this.mode === 'manage-node-types') { options = options['nodes']; }\n  if (this.mode === 'manage-edge-types') { options = options['edges']; }\n\n  // save changes\n  utils.writeFieldData(this.pipeTRef, this.extensionTField, options, $tm.config.sys.jsonIndentation);\n\n  // hack to ensure vis doesn't scroll\n  var cls = 'vis-configuration-wrapper';\n  var div = this.networkContainer.getElementsByClassName(cls)[0];\n  div.style.height = div.getBoundingClientRect().height + 'px';\n\n  if (isReset) {\n\n    // we need to use a timeout here, otherwise we cause a vis bug\n    // since it is in the middle of storing the value!\n    window.setTimeout(this.refresh.bind(this), 0);\n\n  } else {\n\n    // add active-config indicators\n    window.setTimeout(this.enhanceConfigurator.bind(this), 50);\n\n  }\n\n};\n\n/**\n * enhanceConfigurator over all config items and add an indicator.\n */\nMapConfigWidget.prototype.enhanceConfigurator = function() {\n\n  var cls = 'vis-configuration-wrapper';\n  var elements = this.networkContainer\n                     .getElementsByClassName(cls)[0].children;\n  var list = [];\n  var changes = utils.flatten(this.changes);\n  for (var i = 0; i < elements.length; i++) {\n    if (!elements[i].classList.contains('vis-config-item')) continue;\n\n    var conf = new VisConfElement(elements[i], list, i);\n    list.push(conf);\n\n    if (conf.level === 0) continue;\n\n    conf.setActive(!!changes[conf.path]);\n\n  }\n};\n\n/**\n *\n * @param {DOMElement} The config item element.\n * @param {Array<VisConfElement>} a list of VisConfElements of which\n *     this element is also part of.\n * @param {number} the position in the list\n */\nfunction VisConfElement(el, list, pos) {\n\n  var getByCls = 'getElementsByClassName';\n\n  this.el = el;\n  this.labelEl = el[getByCls]('vis-config-label')[0]\n                 || el[getByCls]('vis-config-header')[0]\n                 || el;\n  var labelText = (this.labelEl.innerText || this.labelEl.textContent);\n  this.label = labelText && labelText.match(/([a-zA-Z0-9]+)/)[1];\n  this.level = parseInt(el.className.match(/.*vis-config-s(.).*/)[1]) || 0;\n\n  this.path = this.label;\n\n  if (this.level > 0) {\n    for (var i = pos; i--;) {\n      var prev = list[i];\n      if (prev.level < this.level) {\n        this.path = prev.path + '.' + this.path;\n        break;\n      }\n    }\n  }\n}\n\nVisConfElement.prototype.setActive = function(isEnable) {\n\n  if (!isEnable) return;\n\n  // cannot use utils.hasKeyWithPrefix because some keys start with\n  // same value as others\n  var cls = 'tmap-vis-config-item-' + (isEnable ? 'active' : 'inactive');\n  $tw.utils.addClass(this.el, cls);\n\n  if (isEnable) {\n\n    var button = document.createElement('button');\n    button.innerHTML = 'reset';\n    button.className = 'tmap-config-item-reset';\n\n    var self = this;\n\n    button.addEventListener('click', function(ev) {\n      ev.currentTarget.dispatchEvent(new CustomEvent('reset', {\n        detail: { trigger: self },\n        bubbles: true,\n        cancelable: true\n      }));\n    }, false);\n\n    this.el.appendChild(button);\n  }\n\n};\n\n/**\n *\n *\n */\nMapConfigWidget.prototype.getOptionFilter = function(mode) {\n\n  var whitelist = {\n    nodes: {\n      borderWidth: true,\n      borderWidthSelected: true,\n      color: {\n        background: true,\n        border: true\n      },\n      font: {\n        color: true,\n        size: true\n      },\n      icon: true,\n      labelHighlightBold: false,\n      shadow: true,\n      shape: true,\n      shapeProperties: {\n        borderDashes: true,\n\n      },\n      size: true\n    },\n    edges: {\n      arrows: true,\n      color: true,\n      dashes: true,\n      font: true,\n      labelHighlightBold: false,\n      length: true,\n      selfReferenceSize: false,\n      shadow: true,\n      smooth: true,\n      width: true\n    },\n    interaction: {\n      hideEdgesOnDrag: true,\n      hideNodesOnDrag: true,\n      tooltipDelay: true\n    },\n    layout: {\n      hierarchical: false\n    },\n    manipulation: {\n      initiallyActive: true\n    },\n    physics: {\n      forceAtlas2Based: {\n        gravitationalConstant: true,\n        springLength: true,\n        springConstant: true,\n        damping: true,\n        centralGravity: true\n      }\n    }\n  };\n\n  if (mode === 'manage-edge-types') {\n    whitelist = { edges: whitelist.edges };\n  } else if (mode === 'manage-node-types') {\n    whitelist = { nodes: whitelist.nodes };\n  } else {\n    whitelist.edges.arrows = false;\n  }\n\n  return function(option, path) {\n\n    // operate on a clone; add option as element\n    path = path.concat([ option ]);\n\n    var wlObj = whitelist;\n    for (var i = 0, l = path.length; i < l; i++) {\n      if (wlObj[path[i]] === true) {\n        return true;\n      } else if (wlObj[path[i]] == null) {\n        return false;\n      } // else assume object\n      wlObj = wlObj[path[i]];\n    }\n\n    return false;\n\n  };\n\n};\n\n/**\n * A zombie widget is a widget that is removed from the dom tree\n * but still referenced or still partly executed -- I mean\n * otherwise you couldn't call this function, right?\n *\n * @TODO Outsource this as interface or common super class\n */\nMapConfigWidget.prototype.isZombieWidget = function() {\n\n  return !document.body.contains(this.parentDomNode);\n\n};\n\n/**\n * called from outside.\n *\n * @TODO Outsource this as interface or common super class\n */\nMapConfigWidget.prototype.destruct = function() {\n\n  if (this.network) {\n    this.network.destroy();\n  }\n\n};\n\n/**\n * This function is called by the system to notify the widget about\n * tiddler changes.\n *\n * @override\n */\nMapConfigWidget.prototype.refresh = function(changedTiddlers) {\n\n  if (this.isZombieWidget() || !this.network) return;\n\n  if (!changedTiddlers || changedTiddlers[this.refreshTrigger]) {\n    this.refreshSelf();\n    return true;\n  }\n\n};\n\nMapConfigWidget.prototype.setNull = function(obj) {\n\n  for (var p in obj) {\n\n    if (typeof obj[p] == 'object') {\n\n      this.setNull(obj[p]);\n    } else {\n\n      obj[p] = undefined;\n    }\n  }\n\n};\n\n\n/*** Exports *******************************************************/\n\nexports['tmap-config'] = MapConfigWidget;\n"],"sourceRoot":"../../../../../../src/plugins"}